{#
 # MySui Online Judge
 # file: install.twig
 # author: MySui Team <mysuioj@gmail.com>
 #         CountStarlight <countstarlight@outlook.com>
 #}
{% set title = 'Installation' %}
{% include 'templates/simple_header.twig' %}

{% if installed %}
	<div id="install_success">
		<h2>MySui Online Judge Installed</h2>
		{% if not key_changed %}
			<p class="msoj_error">
				<code>application/config/config.php</code> is not writable by PHP.
			</p>
			<p>
				For security reasons, you should change the encryption key manually.<br>
				Open <code>application/config/config.php</code> and change the encryption key in this line:
			</p>
			<pre>$config['encryption_key'] = '{{ enc_key }}';</pre>
			<p>
				The key should be a 32-characters string as random as possible, with numbers and uppercase and lowercase letters.<br>
				You can use this random string: <code>{{ random_key }}</code>
			</p>
			<br>
		{% endif %}
		<p class="msoj_ok">MySui Online Judge installed! Now you can <a href="{{ site_url('login') }}">login</a>.</p>
	</div>

{% else %}

	<div id="install_form">
		<h2>安装 MySui Online Judge</h2>
		{{ form_open('install') }}
		<p class="input_p">
			<label for="form_username">管理员用户名：</label>
			<input id="form_username" class="mysui_input" type="text" name="username" required="required" pattern="[0-9A-Za-z]{3,20}" title="The Username field must be between 3 and 20 characters in length, and contain only alpha-numeric characters" value="{{ set_value('username') }}" autofocus/>
			{{ form_error('username', '<div class="msoj_error">', '</div>') }}
		</p>
		<p class="input_p">
			<label for="form_email">管理员邮箱：</label>
			<input id="form_email" type="email" autocomplete="off" name="email" required="required" class="mysui_input" value="{{ set_value('email') }}"/>
			{{ form_error('email', '<div class="msoj_error">', '</div>') }}
		</p>
		<p class="input_p">
			<label for="form_password">管理员密码：</label>
			<input id="form_password" type="password" name="password" required="required" pattern="[0-9A-Za-z]{6,20}" title="The Password field must be between 6 and 30 characters in length, and contain only alpha-numeric characters" class="mysui_input"/>
			{{ form_error('password', '<div class="msoj_error">', '</div>') }}
		</p>
		<p class="input_p">
			<label for="form_password_2">再次输入密码：</label>
			<input id="form_password_2" type="password" name="password_again" required="required" class="mysui_input"/>
			{{ form_error('password_again', '<div class="msoj_error">', '</div>') }}
		</p>
		<p class="input_p">
			<input class="mysui_input" type="submit" value="继续"/>
		</p>
		</form>
	</div>
{% endif %}
</body>
</html>
